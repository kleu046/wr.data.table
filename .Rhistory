library(magrittr)
download.file(url = "https://covid.ourworldindata.org/data/owid-covid-data.csv", destfile = "owid-covid-data.csv")
#download.file(url = "https://covid.ourworldindata.org/data/owid-covid-data.csv", destfile = "owid-covid-data.csv")
covid_world_source <-
read_csv("owid-covid-data.csv")
colnames(covid_world_source)
df <-
covid_world_source %>%
select(
continent,
location,
population,
population_density,
human_development_index,
life_expectancy,
date,
new_cases,
new_deaths,
icu_patients,
hosp_patients,
weekly_icu_admissions,
new_tests,
positive_rate,
tests_per_case,
new_vaccinations,
people_fully_vaccinated,
diabetes_prevalence,
female_smokers,
male_smokers,
handwashing_facilities,
hospital_beds_per_thousand
) %>% mutate(date = ymd(date), wk = week(date))
prep <-
df %>%
select(
date,
continent,
location,
human_development_index,
new_cases,
icu_patients,
new_deaths,
new_vaccinations,
people_fully_vaccinated,
population,
population_density,
hospital_beds_per_thousand
) %>%
filter(
location != continent
) %>%
mutate(
people_fully_vaccinated_per_population =
cut((people_fully_vaccinated / population), breaks=c(0, 0.25, 0.5, 0.75, 1))
)
# new cases
prep %>%
filter(!is.na(people_fully_vaccinated_per_population)) %>%
ggplot(
aes(
x = date,
y = new_cases / population,
)
) +
geom_point(
aes(colour = people_fully_vaccinated_per_population),
shape = 21,
size = 1
) +
facet_wrap(~ continent) +
scale_color_brewer(palette = "Set1")
# new icu patients
prep %>%
filter(!is.na(people_fully_vaccinated_per_population)) %>%
ggplot(
aes(
x = date,
y = icu_patients / population,
)
) +
geom_point(
aes(colour = people_fully_vaccinated_per_population),
shape = 21,
size = 1
) +
facet_wrap(~ continent) +
scale_color_brewer(palette = "Set1")
# new deaths
prep %>%
filter(!is.na(people_fully_vaccinated_per_population)) %>%
ggplot(
aes(
x = date,
y = new_deaths / population,
)
) +
geom_point(
aes(colour = as.factor(people_fully_vaccinated_per_population)),
shape = 21,
size = 1
) +
facet_wrap(~ continent) +
scale_color_brewer(palette = "Set1")
prep %>%
mutate(
wave_worsening = if_else(
(new_cases - lag(new_cases, n = 14)) > 0,
T,
F)
) %>%
filter(
!is.na(icu_patients) &
!is.na(population) &
!is.na(wave_worsening)
) %>%
ggplot(
aes(
x = date,
y = icu_patients / population,
)
) +
geom_point(
aes(colour = wave_worsening),
shape = 21,
size = 1
) +
facet_wrap(~ continent) +
scale_color_brewer(
"No of cases \nincreasing",
palette = "Set1",
)
# new vaccinations vs a wave happening
prep %>%
mutate(
wave_worsening = if_else(
(new_cases - lag(new_cases, n = 14)) > 0,
T,
F)
) %>%
filter(
!is.na(new_vaccinations) &
!is.na(wave_worsening)
) %>%
ggplot(
aes(
x = date,
y = new_vaccinations / population,
)
) +
geom_point(
aes(colour = wave_worsening,
fill = wave_worsening),
alpha = 0.5
) +
facet_wrap(~ continent)
# new vaccinations vs a wave happening
prep %>%
filter(
!is.na(new_vaccinations) &
!is.na(icu_patients)
) %>%
ggplot(
aes(
x = date,
y = new_vaccinations / population,
)
) +
geom_point(
aes(color = icu_patients),
alpha = 0.3
) +
facet_wrap(~ continent) +
scale_color_gradient2(low = "red", high = "blue", mid=median(prep$icu_patients,na.rm=TRUE))
covid_pca <- covid_world_source %>%
select(
population,
population_density,
human_development_index,
life_expectancy,
new_cases,
new_deaths,
icu_patients,
hosp_patients,
weekly_icu_admissions,
new_tests,
positive_rate,
tests_per_case,
new_vaccinations,
people_fully_vaccinated,
diabetes_prevalence,
female_smokers,
male_smokers,
hospital_beds_per_thousand
) %>%
na.omit() %>%
prcomp(scale=TRUE)
library(factoextra)
fviz_pca_biplot(covid_pca, repel = TRUE,
col.var = "#2E9FDF",
col.ind = "#696969",
label = "var"
)
covid <- covid_world_source %>%
select(
continent,
location,
population,
population_density,
human_development_index,
life_expectancy,
new_cases,
new_deaths,
icu_patients,
hosp_patients,
weekly_icu_admissions,
new_tests,
positive_rate,
tests_per_case,
new_vaccinations,
people_fully_vaccinated,
diabetes_prevalence,
female_smokers,
male_smokers,
hospital_beds_per_thousand
) %>%
na.omit()
covid_k <-
covid %>%
select(
-continent,
-location
)
k <-
furrr::future_map(
covid_kmeans,
function(x){
(x - mean(x))/sd(x)
}
) %>%
as_tibble() %>%
kmeans(centers = 5)
k <-
furrr::future_map(
covid_k,
function(x){
(x - mean(x))/sd(x)
}
) %>%
as_tibble() %>%
kmeans(centers = 5)
covid_k <-
furrr::future_map(
covid_k,
function(x){
(x - mean(x))/sd(x)
}
) %>%
as_tibble() %>%
kmeans(centers = 5)
covid_k %<>% mutate(groups = as.factor(k$cluster),
continent = covid$continent,
location = covid$location)
covid <- covid_world_source %>%
select(
continent,
location,
population,
population_density,
human_development_index,
life_expectancy,
new_cases,
new_deaths,
icu_patients,
hosp_patients,
weekly_icu_admissions,
new_tests,
positive_rate,
tests_per_case,
new_vaccinations,
people_fully_vaccinated,
diabetes_prevalence,
female_smokers,
male_smokers,
hospital_beds_per_thousand
) %>%
na.omit()
covid_k <-
covid %>%
select(
-continent,
-location
)
k <-
furrr::future_map(
covid_k,
function(x){
(x - mean(x))/sd(x)
}
) %>%
as_tibble() %>%
kmeans(centers = 5)
covid_k %<>% mutate(groups = as.factor(k$cluster),
continent = covid$continent,
location = covid$location)
covid_k %>%
ggplot(
aes(
x=people_fully_vaccinated/population,
y=icu_patients/population
)
) +
geom_point(
aes(color=groups),
size = 4,
alpha = 0.6
) +
scale_color_brewer(palette = "Set1") +
facet_wrap(~location)
covid_k %>%
ggplot(
aes(
x=people_fully_vaccinated/population,
y=icu_patients/population
)
) +
geom_point(
aes(color=location),
size = 4,
alpha = 0.6
) +
scale_color_brewer(palette = "Set1") +
facet_wrap(~group)
covid_k %>%
ggplot(
aes(
x=people_fully_vaccinated/population,
y=icu_patients/population
)
) +
geom_point(
aes(color=location),
size = 4,
alpha = 0.6
) +
scale_color_brewer(palette = "Set1") +
facet_wrap(~group)
covid_k %>%
ggplot(
aes(
x=people_fully_vaccinated/population,
y=icu_patients/population
)
) +
geom_point(
aes(color=location),
size = 4,
alpha = 0.6
) +
scale_color_brewer(palette = "Set1") +
facet_wrap(~groups)
# rename location in covid data
covid %<>% mutate(location=replace(covid$location, grep("Congo", covid$location), "Congo"))
covid %>% filter(location == "Saint Kitts and Nevis")
# world_map data
world_map <- map_data("world")
# rename region in world map
replace_name <- function(map, regex, with){
map %>% mutate(region=replace(region, grep(regex, region), with))
}
world_map %<>% replace_name("USA", "United States")
world_map %<>% replace_name("Barbuda", "Antigua and Barbuda")
world_map %<>% replace_name("Antigua", "Antigua and Barbuda")
world_map %<>% replace_name("Congo", "Congo")
world_map %<>% replace_name("UK", "United Kingdom")
world_map %<>% replace_name("Czech", "Czechia")
world_map %<>% replace_name("Macedonia", "North Macedonia")
world_map %<>% replace_name("Trinidad", "Trinidad and Tobago")
world_map %<>% replace_name("Tobago", "Trinidad and Tobago")
world_map %<>% replace_name("Timor-Leste", "Timor")
world_map %<>% replace_name("Saint Martin", "Sint Maarten (Dutch part)")
world_map %<>% replace_name("Virgin Islands", "British Virgin Islands")
world_map %<>% replace_name("Swaziland", "Eswatini")
world_map %<>% replace_name("Pitcairn Islands", "Pitcairn")
world_map %<>% replace_name("Saint Kitts", "Saint Kitts and Nevis")
world_map %<>% replace_name("Nevis", "Saint Kitts and Nevis")
unique(world_map$region)[grep("Saint Kitts", unique(world_map$region))]
unique(world_map$region)[order(unique(world_map$region))]
library(data.table)
vac <- data.table(covid)[location != "World" & location != continent & !is.na(people_fully_vaccinated) & !is.na(population),][,.(location=location, fully_vac=people_fully_vaccinated/population)]
vac <- vac[,.(fully_vac=max(fully_vac)),by=location]
vac[location == "China",]
vac <- world_map %>% full_join(vac, by=c("region" = "location"))
vac %>% ggplot(aes(x=long, y=lat, group=group)) +
geom_polygon(aes(fill=fully_vac))
vac %>% filter(is.na(long))
unique(vac$region)[order(unique(vac$region))]
colnames(covid)
continents <- covid %>%
filter(!is.na(continent) & !is.na(people_fully_vaccinated) & !is.na(people_vaccinated) & !is.na(population)) %>%
select(continent, location, people_fully_vaccinated,people_vaccinated, population)
continents <- data.table(continents)[,.(continent, full_vac=people_fully_vaccinated/population, vac=people_vaccinated/population, location, population)][,.(fully_vac=max(full_vac),population=max(population)),by=.(continent, location)]
continents
unique(continents$continent)
library(forcats)
library(gridExtra)
plot_continent <- function(continentString, data) {
p <- data %>%
filter(continents == continentString) %>%
ggplot(aes(x=fct_reorder(location, population), y=fully_vac*100)) +
geom_col(aes(fill=fully_vac)) +
scale_fill_gradient2(
low="red",
high="green",
midpoint=median(data$fully_vac)
) +
theme_classic() +
theme(legend.position = "none") +
ylim(c(0,100)) +
labs(x = NULL, y = NULL) +
coord_flip() +
ggtitle(toupper(continentString))
p
}
library(purrr)
library(furrr)
p <- map(unique(continents$continent),plot_continent, data = continents)
p <- future_map(unique(continents$continent),plot_continent, data = continents)
library(grid)
library(gridExtra)
grid.arrange(
p[[1]],
p[[2]],
p[[3]],
p[[4]],
p[[5]],
p[[6]],
nrow=2,
top = textGrob(
paste0(
"Full Vaccination Rate by Country as of",
format(Sys.time(), "%d %b %Y")
)
),
bottom = textGrob(
"Fully Vaccination Rate \as % of country population"
),
left = textGrob(
"Countries",
rot = 90
)
)
# coivd data
download.file(url = "https://covid.ourworldindata.org/data/owid-covid-data.csv", destfile = "owid-covid-data.csv")
library(readr)
(covid <-
read_csv("owid-covid-data.csv",
)
)
# rename location in covid data
covid %<>% mutate(location=replace(covid$location, grep("Congo", covid$location), "Congo"))
covid %>% filter(location == "Saint Kitts and Nevis")
# world_map data
world_map <- map_data("world")
# rename region in world map
replace_name <- function(map, regex, with){
map %>% mutate(region=replace(region, grep(regex, region), with))
}
world_map %<>% replace_name("USA", "United States")
world_map %<>% replace_name("Barbuda", "Antigua and Barbuda")
world_map %<>% replace_name("Antigua", "Antigua and Barbuda")
world_map %<>% replace_name("Congo", "Congo")
world_map %<>% replace_name("UK", "United Kingdom")
world_map %<>% replace_name("Czech", "Czechia")
world_map %<>% replace_name("Macedonia", "North Macedonia")
world_map %<>% replace_name("Trinidad", "Trinidad and Tobago")
world_map %<>% replace_name("Tobago", "Trinidad and Tobago")
world_map %<>% replace_name("Timor-Leste", "Timor")
world_map %<>% replace_name("Saint Martin", "Sint Maarten (Dutch part)")
world_map %<>% replace_name("Virgin Islands", "British Virgin Islands")
world_map %<>% replace_name("Swaziland", "Eswatini")
world_map %<>% replace_name("Pitcairn Islands", "Pitcairn")
world_map %<>% replace_name("Saint Kitts", "Saint Kitts and Nevis")
world_map %<>% replace_name("Nevis", "Saint Kitts and Nevis")
unique(world_map$region)[grep("Saint Kitts", unique(world_map$region))]
unique(world_map$region)[order(unique(world_map$region))]
library(data.table)
vac <- data.table(covid)[location != "World" & location != continent & !is.na(people_fully_vaccinated) & !is.na(population),][,.(location=location, fully_vac=people_fully_vaccinated/population)]
vac <- vac[,.(fully_vac=max(fully_vac)),by=location]
vac[location == "China",]
vac <- world_map %>% full_join(vac, by=c("region" = "location"))
vac %>% ggplot(aes(x=long, y=lat, group=group)) +
geom_polygon(aes(fill=fully_vac))
vac %>% filter(is.na(long))
vac %>% ggplot(aes(x=long, y=lat, group=group)) +
geom_polygon(aes(fill=fully_vac)) +
theme_void()
vac %>% ggplot(aes(x=long, y=lat, group=group)) +
geom_rect() +
geom_polygon(aes(fill=fully_vac)) +
theme_void()
vac %>% ggplot(aes(x=long, y=lat, group=group)) +
geom_rect(fill=NA) +
geom_polygon(aes(fill=fully_vac)) +
theme_void()
vac %>% ggplot(aes(x=long, y=lat, group=group)) +
geom_rect(fill=NA) +
geom_polygon(aes(fill=fully_vac)) +
theme_void()
vac %>% ggplot(aes(x=long, y=lat, group=group)) +
geom_polygon(aes(fill=fully_vac)) +
theme_void()
cut(1:10, breaks=c(1,3,5,10))
