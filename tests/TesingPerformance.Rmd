---
title: "TestScript"
author: "Ka Lok Leung"
date: "24/08/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
library(wr.data.table)
library(data.table)
library(dplyr)
```

```{r generate_data, include=FALSE}
dt <- data.table(mtcars)

wr_dt_keeprownames <- function(dt, n) {
  for (i in 1:n) {
    dt <- rbind(dt, dt)
  }
  data.table(dt)
}

manyRows <- lapply(c(2,5,10),function(x){wr_dt_keeprownames(dt, x)})
#str(manyRows)


dtwithmanycols <- function(dt,n ) {
  for (i in 1:n) {
    dt <- cbind(dt, dt)
  }
  data.table(dt, check.names = TRUE)
}

manyCols <- lapply(c(2,5,10), function(x){dtwithmanycols(dt, x)})
#str(manyCols)

getDT <- function(x) {
  x[1]
}
```

```{r wr_order_rows}
# wr_order
result_wr_order_rows <- purrr::map(manyRows, function(x) {
  microbenchmark::microbenchmark(
    wr_order(getDT(x), am, vs),
    setorder(getDT(x),am,vs),
    getDT(x) |> arrange(am, vs))
})
#result_wr_order_rows
purrr::map(result_wr_order_rows, boxplot)
```

```{r wr_order_cols}
result_wr_order_cols <- purrr::map(manyCols, function(x) {
  microbenchmark::microbenchmark(
    wr_order(getDT(x), am, vs),
    setorder(getDT(x),am,vs),
    getDT(x) |> dplyr::arrange(am, vs))
})
#result_wr_order_cols
purrr::map(result_wr_order_cols, boxplot)
```

```{r wr_summarize_rows}
result_wr_summarize_rows <- purrr::map(manyRows, function(x){
  microbenchmark::microbenchmark(
    wr_groupby(getDT(x), gear, am) |> wr_summarize(mu_mpg=mean(mpg),sd_mpg=sd(mpg)),
    getDT(x)[,.(mu_mpg=mean(mpg),sd_mpg=sd(mpg)),by=list(gear,am)],
    getDT(x) |> group_by(gear, am) |> summarise(mu_mpg=mean(mpg),sd_mpg=sd(mpg), .groups="drop")
  )
})
result_wr_summarize_rows
purrr::map(result_wr_summarize_rows, boxplot)
```

```{r wr_summarize_cols}
result_wr_summarize_cols <- purrr::map(manyCols, function(x){
  microbenchmark::microbenchmark(
    wr_groupby(getDT(x), gear, am) |> wr_summarize(mu_mpg=mean(mpg),sd_mpg=sd(mpg)),
    getDT(x)[,.(mu_mpg=mean(mpg),sd_mpg=sd(mpg)),by=list(gear,am)],
    getDT(x) |> group_by(gear, am) |> summarise(mu_mpg=mean(mpg),sd_mpg=sd(mpg), .groups="drop")
  )
})
result_wr_summarize_cols
purrr::map(result_wr_summarize_cols, boxplot)
```

```{r wr_summarize_cols}
result_wr_summarize_cols <- purrr::map(manyCols, function(x){
  microbenchmark::microbenchmark(
    wr_groupby(getDT(x), gear, am) |> wr_summarize(mu_mpg=mean(mpg),sd_mpg=sd(mpg)),
    getDT(x)[,.(mu_mpg=mean(mpg),sd_mpg=sd(mpg)),by=list(gear,am)],
    getDT(x) |> group_by(gear, am) |> summarise(mu_mpg=mean(mpg),sd_mpg=sd(mpg), .groups="drop")
  )
})
result_wr_summarize_cols
purrr::map(result_wr_summarize_cols, boxplot)
```
